<head>
  <!-- <script src='//unpkg.com/timelines-chart'></script> -->
  <script src="../../dist/timelines-chart.js"></script>

  <script src="../get_trace_json.js"></script>
</head>

<body>
  <script>
    let input = [];

    input = input.map((row) => {
      return {
        time: extractMicrosecondsTenUnit(row.timestamp),
        id: row.fields.worker_id,
        type: row.fields.typ,
      };
    });

    function extractMicrosecondsTenUnit(isoString) {
      const parts = isoString.match(/(\d{2})\.(\d{6})\d*Z$/);
      if (!parts) {
        throw new Error(
          "No appropriate seconds and microseconds format found in the input string"
        );
      }

      // 秒とマイクロ秒部分の取得
      const seconds = parts[1];
      let microseconds = parts[2].slice(0, -1); // 最後の1桁を切り捨てる

      // 10マイクロ秒単位までの値を生成
      const result = `${seconds}.${microseconds}`;

      return Number(result) * 100000;
    }

    const data = processEvents(input);

    // const expectedInput = [
    //   {
    //     typ: "Start",
    //     worker_id: 3,
    //     time: 332, // in nano seconds
    //     data: {
    //       task_id: 1, // if start.
    //     }
    //   },
    //   {
    //     typ: "Park",
    //     worker_id: 1,
    //     time: 32, // in nano seconds
    //     data: {}
    //   },
    // ]
    // const data = [
    //   {
    //     group: 'Worker 1',
    //     data: [
    //       {
    //         label: 'Label 1',
    //         data: [
    //           {
    //             timeRange: [0,200],
    //             val: "task1"
    //           },
    //           {
    //             timeRange: [200, 220],
    //             val: "task2"
    //           },
    //           {
    //             timeRange: [220, 300],
    //             val: "Park"
    //           },
    //           {
    //             timeRange: [300, 300],
    //             val: "task2"
    //           },
    //         ]
    //       }
    //     ]
    //   },
    //   {
    //     group: 'Worker 2',
    //     data: [
    //       {
    //         label: 'Label 1',
    //         data: [
    //           {
    //             timeRange: [0,300],
    //             val: "task1"
    //           },
    //         ]
    //       }
    //     ]
    //   },
    //   {
    //     group: 'Worker 3',
    //     data: [
    //       {
    //         label: 'Label 1',
    //         data: [
    //           {
    //             timeRange: [0,20],
    //             val: "task3"
    //           },
    //           {
    //             timeRange: [20, 49],
    //             val: "task4"
    //           },
    //           {
    //             timeRange: [49, 300],
    //             val: "Park"
    //           },
    //         ]
    //       }
    //     ]
    //   },
    // ]

    TimelinesChart()(document.body)
      .zScaleLabel("My Scale Units")
      .zQualitative(true)
      // .dateMarker(new Date() - 365 * 24 * 60 * 60 * 1000) // Add a marker 1y ago
      // .data(myData);
      .data(data);
  </script>
</body>
